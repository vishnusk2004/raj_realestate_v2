{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open House Schedule - {{ brand_name }}</title>
    <meta name="description" content="Visit our beautiful properties at your convenience. Book your open house viewing with {{ brand_name }}.">
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/django-main.css' %}">
    
    <style>
        /* Modal styling to ensure visibility */
        #bookingModal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 9999 !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 1rem !important;
        }
        
        #bookingModal .modal-content {
            background-color: white !important;
            border-radius: 0.5rem !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
            max-width: 42rem !important;
            width: 100% !important;
            max-height: 90vh !important;
            overflow-y: auto !important;
        }
        
        #bookingModal input,
        #bookingModal select,
        #bookingModal textarea {
            width: 100% !important;
            padding: 0.5rem 0.75rem !important;
            border: 1px solid #d1d5db !important;
            border-radius: 0.375rem !important;
            font-size: 0.875rem !important;
            line-height: 1.25rem !important;
        }
        
        #bookingModal input:focus,
        #bookingModal select:focus,
        #bookingModal textarea:focus {
            outline: none !important;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        }
        
        #bookingModal button {
            cursor: pointer !important;
            transition: all 0.15s ease-in-out !important;
        }
        
        #bookingModal button:hover {
            opacity: 0.9 !important;
        }
        
        /* Ensure modal is visible and properly positioned */
        body.modal-open {
            overflow: hidden !important;
        }
        
        #bookingModal {
            backdrop-filter: blur(4px) !important;
        }
        
        #bookingModal .modal-content {
            animation: modalSlideIn 0.3s ease-out !important;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    </style>
    
</head>
<body>
{% include 'Raj/navbar.html' %}

<!-- Hero Section -->
    <section class="bg-gradient-surface py-16 my-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-foreground mb-4">Open House Schedule</h1>
                <p class="text-xl text-muted-foreground max-w-2xl mx-auto mb-6">Visit our beautiful properties at your convenience. Select a date from our calendar and book your preferred open house viewing.</p>
            </div>
        </div>
    </section>

    <!-- Open House Properties -->
    <section class="py-16 bg-background">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            {% if open_houses %}
                <div class="mb-12">
                    <h2 class="text-3xl font-bold text-foreground mb-4">Upcoming Open Houses</h2>
                    <p class="text-lg text-muted-foreground">Visit our beautiful properties at your convenience</p>
            </div>
            
                <div class="grid gap-8">
                    {% for open_house in open_houses %}
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden shadow-medium hover:shadow-strong transition-all duration-300">
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div class="relative">
                                <div class="grid grid-cols-3 gap-2 h-64 lg:h-full">
                                    {% if open_house.get_main_image_url %}
                                        <img src="{{ open_house.get_main_image_url }}" alt="{{ open_house.title }}" class="col-span-2 w-full h-full object-cover rounded-l-lg">
                                    {% else %}
                                        <img src="{% static 'images/property-1.jpg' %}" alt="{{ open_house.title }}" class="col-span-2 w-full h-full object-cover rounded-l-lg">
                                    {% endif %}
                                    <div class="space-y-2">
                                        {% for image in open_house.images.all|slice:":2" %}
                                            {% if forloop.first %}
                                                <img src="{{ image.get_image_url }}" alt="{{ open_house.title }}" class="w-full h-1/2 object-cover rounded-tr-lg">
                                            {% else %}
                                                <img src="{{ image.get_image_url }}" alt="{{ open_house.title }}" class="w-full h-1/2 object-cover">
                                            {% endif %}
                                        {% empty %}
                                            <img src="{% static 'images/property-2.jpg' %}" alt="{{ open_house.title }}" class="w-full h-1/2 object-cover rounded-tr-lg">
                                            <img src="{% static 'images/property-3.jpg' %}" alt="{{ open_house.title }}" class="w-full h-1/2 object-cover">
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent hover:bg-primary/80 absolute top-4 left-4 bg-accent text-accent-foreground">Open House</div>
                            </div>
                            <div class="p-6 lg:p-8">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-2xl font-bold text-foreground">{{ open_house.title }}</h3>
                                    <div class="text-2xl font-bold text-primary">${{ open_house.price|floatformat:0|intcomma }}</div>
                                </div>
                                <div class="flex items-center text-muted-foreground mb-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin w-4 h-4 mr-2">
                                        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <span class="text-sm">{{ open_house.property_address }}</span>
                                </div>
                                <div class="flex items-center space-x-6 text-sm text-muted-foreground mb-4">
                                    {% if open_house.bedrooms %}
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house w-4 h-4 mr-1">
                                            <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path>
                                            <path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                        </svg>
                                        <span>{{ open_house.bedrooms }} beds</span>
                                    </div>
                                    {% endif %}
                                    {% if open_house.bathrooms %}
                                    <div class="flex items-center">
                                        <span>{{ open_house.bathrooms }} baths</span>
                                    </div>
                                    {% endif %}
                                    {% if open_house.area_sqft %}
                                    <div class="flex items-center">
                                        <span>{{ open_house.area_sqft|intcomma }} sqft</span>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="flex items-center text-accent">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-4 h-4 mr-2">
                                            <path d="M8 2v4"></path>
                                            <path d="M16 2v4"></path>
                                            <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                            <path d="M3 10h18"></path>
                                        </svg>
                                        <span class="font-medium">{{ open_house.open_house_date|date:"M j, Y" }}</span>
                                    </div>
                                    <div class="flex items-center text-accent">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock w-4 h-4 mr-2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                        <span class="font-medium">{{ open_house.open_house_time|time:"g:i A" }}</span>
                                    </div>
                                </div>
                                <p class="text-muted-foreground mb-4 leading-relaxed">{{ open_house.description }}</p>
                                {% if open_house.get_features_list %}
                                <div class="flex flex-wrap gap-2 mb-6">
                                    {% for feature in open_house.get_features_list %}
                                    <div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-primary/20 text-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check-big w-3 h-3 mr-1">
                                            <path d="M21.801 10A10 10 0 1 1 17 3.335"></path>
                                            <path d="m9 11 3 3L22 4"></path>
                                        </svg>
                                        {{ feature }}
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-muted-foreground">
                                        <span>Hosted by: </span>
                                        <span class="font-medium text-foreground">RealtyPro Team</span>
                                    </div>
                                    <button onclick="openBookingModal({{ open_house.id }}, '{{ open_house.title }}', '{{ open_house.property_address }}', '{{ open_house.open_house_date|date:"M j, Y" }}', '{{ open_house.open_house_time|time:"g:i A" }}', '{{ open_house.price }}')" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 h-10 px-4 py-2 bg-primary hover:bg-primary-dark text-primary-foreground">
                                        Book / Get More Info
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-16">
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm p-8 shadow-soft max-w-md mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-x mx-auto mb-4 text-muted-foreground">
                            <path d="M8 2v4"></path>
                            <path d="M16 2v4"></path>
                            <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                            <path d="M3 10h18"></path>
                            <path d="m14.5 14.5 5 5"></path>
                            <path d="m19.5 14.5-5 5"></path>
                        </svg>
                        <h3 class="text-xl font-semibold text-foreground mb-2">No Open Houses Scheduled</h3>
                        <p class="text-muted-foreground mb-6">We don't have any open houses scheduled at the moment. Please check back later or contact us for more information.</p>
                        <a href="{% url 'buy_lease' %}" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:bg-accent h-10 text-primary hover:text-primary-foreground px-4 py-2 bg-accent hover:shadow-accent">
                            View Available Properties
                        </a>
                </div>
            </div>
            {% endif %}
    </div>
</section>

{% include 'Raj/footer.html' %}

    <!-- Custom JavaScript -->
    <script src="{% static 'js/django-main-fixed.js' %}"></script>
    
    <script>
        function openBookingModal(openHouseId, title, address, date, time, price) {
            // Create modal HTML
            const modalHTML = `
                <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4" style="z-index: 9999;">
                    <div class="modal-content bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" style="background-color: white; border-radius: 0.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); max-width: 42rem;">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold" style="color: #111827; font-size: 1.25rem; font-weight: 700;">Book Visit / Get More Info</h3>
                                <button onclick="closeBookingModal()" class="text-gray-400 hover:text-gray-600" style="color: #9ca3af; transition: color 0.15s ease-in-out;">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="mb-4 p-4 bg-gray-50 rounded-lg" style="background-color: #f9fafb; border-radius: 0.5rem; margin-bottom: 1rem; padding: 1rem;">
                                <h4 class="font-semibold" style="font-weight: 600; color: #111827;">${title}</h4>
                                <p class="text-sm" style="font-size: 0.875rem; color: #4b5563;">${address}</p>
                                <p class="text-sm" style="font-size: 0.875rem; color: #4b5563;">${date} at ${time}</p>
                                <p class="text-sm font-medium" style="font-size: 0.875rem; font-weight: 500; color: #111827;">$${price.toLocaleString()}</p>
                        </div>

                            <div class="mb-4 p-3 bg-blue-50 rounded-lg" style="background-color: #eff6ff; border-radius: 0.5rem; margin-bottom: 1rem; padding: 0.75rem;">
                                <p class="text-sm text-blue-700" style="font-size: 0.875rem; color: #1d4ed8; margin: 0;">
                                    <strong>Note:</strong> If you're interested in this specific property, just fill in your contact details. The property type and budget fields below are only if you're looking for something different.
                                </p>
                        </div>

                            <form id="bookingForm" method="POST" action="{% url 'open_house' %}">
                                {% csrf_token %}
                                <input type="hidden" name="open_house_id" value="${openHouseId}">
                                
                                <div class="space-y-4" style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Full Name *</label>
                                        <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                        </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Email Address *</label>
                                        <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                            </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Phone Number *</label>
                                        <input type="tel" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                        </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Property Type</label>
                                        <p class="text-xs text-gray-500 mb-2" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">Fill this if you're looking for something else than this property</p>
                                        <select name="property_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                                    <option value="">Select property type</option>
                                            <option value="house">House</option>
                                            <option value="condo">Condo</option>
                                            <option value="townhouse">Townhouse</option>
                                            <option value="apartment">Apartment</option>
                                </select>
                            </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Budget Range</label>
                                        <p class="text-xs text-gray-500 mb-2" style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">Fill this if you're looking for something else than this property</p>
                                        <select name="budget_range" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                                    <option value="">Select budget range</option>
                                            <option value="under-300k">Under $300K</option>
                                            <option value="300k-500k">$300K - $500K</option>
                                            <option value="500k-750k">$500K - $750K</option>
                                            <option value="750k-1m">$750K - $1M</option>
                                            <option value="over-1m">Over $1M</option>
                                </select>
                        </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Preferred Date</label>
                                        <input type="date" name="preferred_date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                        </div>

                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Preferred Time</label>
                                        <select name="preferred_time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out;">
                                            <option value="">Select preferred time</option>
                                            <option value="morning">Morning (9 AM - 12 PM)</option>
                                            <option value="afternoon">Afternoon (12 PM - 5 PM)</option>
                                            <option value="evening">Evening (5 PM - 8 PM)</option>
                                        </select>
            </div>
            
                                    <div>
                                        <label class="block text-sm font-medium mb-1" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">Message</label>
                                        <textarea name="message" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Any special requirements or questions..." style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: all 0.15s ease-in-out; resize: vertical;"></textarea>
                </div>
            </div>

                                <div class="mt-6 flex gap-3" style="margin-top: 1.5rem; display: flex; gap: 0.75rem;">
                                    <button type="button" onclick="closeBookingModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50" style="flex: 1; padding: 0.5rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; color: #374151; background-color: white; transition: all 0.15s ease-in-out; cursor: pointer;">
                                        Cancel
            </button>
                                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" style="flex: 1; padding: 0.5rem 1rem; background-color: #2563eb; color: white; border-radius: 0.375rem; border: none; transition: all 0.15s ease-in-out; cursor: pointer;">
                                        Submit Request
            </button>
            </div>
                            </form>
        </div>
            </div>
        </div>
            `;
            
            // Add modal to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Prevent body scroll and add modal class
            document.body.style.overflow = 'hidden';
            document.body.classList.add('modal-open');
        }
        
        function closeBookingModal() {
            const modal = document.getElementById('bookingModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
                document.body.style.paddingRight = '';
                document.body.classList.remove('modal-open');
            }
        }

// Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'bookingModal') {
                closeBookingModal();
            }
        });
</script>

    {% include 'Raj/success_popup.html' %}
    
    <script>
    // Handle form submission with success popup
    document.addEventListener('DOMContentLoaded', function() {
        // Use event delegation to handle dynamically created forms
        document.addEventListener('submit', function(e) {
            const form = e.target;
            console.log('Form submitted:', form);
            console.log('Form action:', form.action);
            console.log('Form action includes open-house:', form.action && form.action.includes('open-house'));
            
            if (form && form.action && form.action.includes('open-house')) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(form);
                const name = formData.get('name');
                
                console.log('Showing success popup for:', name);
                
                // Show success popup
                const message = `Thank you for your open house registration, ${name}! Our team will contact you within 24 hours to confirm your visit and provide additional details.`;
                showSuccessPopup(message);
                
                // Submit form after showing popup
                setTimeout(() => {
                    form.submit();
                }, 2000);
            }
        });
    });
</script>

</body>
</html>
