{% load static tailwind_tags %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Buy & Lease Properties - {{ brand_name }}</title>
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    {% tailwind_css %}
    <link rel="stylesheet" href="{% static 'css/dist/styles.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Footer CSS Override -->
    <style>
    footer {
        background-color: #1f2937 !important;
        color: #d1d5db !important;
    }
    footer * {
        color: inherit !important;
    }
    footer h2, footer h3 {
        color: #ffffff !important;
    }
    footer p {
        color: #9ca3af !important;
    }
    footer .text-gray-500 {
        color: #6b7280 !important;
    }
    footer .text-gray-400 {
        color: #9ca3af !important;
    }
    footer .border-gray-700 {
        border-color: #374151 !important;
    }
    </style>
    
    <!-- Theme Toggle CSS -->
    <style>
    /* Dark theme styles */
    .dark-theme {
        background-color: #1a1a1a !important;
        color: #e5e5e5 !important;
    }
    
    .dark-theme .bg-gray-50 {
        background-color: #1a1a1a !important;
    }
    
    .dark-theme .bg-white {
        background-color: #2d2d2d !important;
    }
    
    .dark-theme .text-gray-900 {
        color: #e5e5e5 !important;
    }
    
    .dark-theme .text-gray-700 {
        color: #d1d5db !important;
    }
    
    .dark-theme .text-gray-600 {
        color: #9ca3af !important;
    }
    
    .dark-theme .bg-blue-50 {
        background-color: #1e3a8a !important;
    }
    
    .dark-theme .bg-gray-100 {
        background-color: #374151 !important;
    }
    
    .dark-theme .border-gray-200 {
        border-color: #4b5563 !important;
    }
    
    .dark-theme .shadow-lg {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Modal dark theme styles */
    .dark-theme #propertyModal .bg-white {
        background-color: #1f2937 !important;
    }
    
    .dark-theme #propertyModal .text-gray-900 {
        color: #f9fafb !important;
    }
    
    .dark-theme #propertyModal .text-gray-700 {
        color: #d1d5db !important;
    }
    
    .dark-theme #propertyModal .text-gray-600 {
        color: #9ca3af !important;
    }
    
    .dark-theme #propertyModal .bg-gray-50 {
        background-color: #374151 !important;
    }
    
    .dark-theme #propertyModal .bg-blue-50 {
        background-color: #1e3a8a !important;
    }
    
    .dark-theme #propertyModal .bg-green-50 {
        background-color: #14532d !important;
    }
    
    .dark-theme #propertyModal .text-blue-700 {
        color: #93c5fd !important;
    }
    
    .dark-theme #propertyModal .text-green-700 {
        color: #86efac !important;
    }
    
    .dark-theme #propertyModal .border-b {
        border-color: #4b5563 !important;
    }
    
    .dark-theme #propertyModal .border-t {
        border-color: #4b5563 !important;
    }
    
    .dark-theme #propertyModal .bg-gray-50 {
        background-color: #374151 !important;
    }
    
    /* Theme toggle button */
    #theme-toggle {
        transition: all 0.3s ease;
    }
    
    #theme-icon {
        transition: transform 0.3s ease;
    }
    </style>
    
    <style>
        /* Fallback styles to ensure visibility */
        body { background-color: #f9fafb !important; color: #111827 !important; }
        .text-white { color: #ffffff !important; }
        .text-gray-900 { color: #111827 !important; }
        .text-gray-600 { color: #4b5563 !important; }
        .text-gray-700 { color: #374151 !important; }
        .bg-blue-900 { background-color: #1e3a8a !important; }
        .bg-blue-700 { background-color: #1d4ed8 !important; }
        .bg-white { background-color: #ffffff !important; }
        .bg-gray-50 { background-color: #f9fafb !important; }
        .bg-yellow-500 { background-color: #eab308 !important; }
        .bg-green-600 { background-color: #16a34a !important; }
        .bg-blue-600 { background-color: #2563eb !important; }
        .text-green-600 { color: #16a34a !important; }
        .text-blue-500 { color: #3b82f6 !important; }
        h1, h2, h3, h4, h5, h6 { color: #111827 !important; }
        p { color: #374151 !important; }
        .text-center h1 { color: #ffffff !important; }
        .text-center p { color: #ffffff !important; }
        /* Hero section specific styles */
        .bg-gradient-to-r h1 { color: #ffffff !important; }
        .bg-gradient-to-r p { color: #ffffff !important; }
        .bg-gradient-to-r .text-white { color: #ffffff !important; }
        .bg-gradient-to-r input { color: #111827 !important; background-color: #ffffff !important; }
        .bg-gradient-to-r select { color: #111827 !important; background-color: #ffffff !important; }
        .bg-gradient-to-r button { color: #ffffff !important; }
        
        /* Navbar styling is now handled globally in navbar.html */
    </style>
</head>
<body class="bg-gray-50" style="background-color: #f9fafb; color: #111827;">
    {% include 'Henry/navbar.html' %}

    <div class="min-h-screen bg-gray-50">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-blue-900 to-blue-700 text-white py-20" style="background: linear-gradient(to right, #1e3a8a, #1d4ed8); color: #ffffff;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl md:text-6xl font-bold mb-6" style="color: #ffffff !important;">Find Your Perfect Property</h1>
                <p class="text-xl md:text-2xl mb-8" style="color: #ffffff !important;">Discover amazing properties for sale and lease in your area</p>
                
                <!-- Search and Filter Bar -->
                <div class="max-w-4xl mx-auto" style="max-width: 56rem !important;">
                    <form method="GET" class="flex flex-col md:flex-row gap-4" style="display: flex !important; flex-direction: column !important; gap: 1rem !important;">
                        <div class="flex-1" style="flex: 1 1 0% !important; min-width: 0 !important;">
                            <input type="text" name="search" value="{{ search_query }}" 
                                   placeholder="Search by location, address, or description..." 
                                   class="w-full px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300"
                                   style="width: 100% !important; color: #111827 !important; background-color: #ffffff !important; padding: 0.75rem 1rem !important; border-radius: 0.5rem !important;">
                        </div>
                        <div class="flex gap-3" style="display: flex !important; gap: 0.75rem !important; flex-shrink: 0 !important;">
                            <select name="type" class="px-4 py-3 pr-10 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300 min-w-[140px] appearance-none bg-white"
                                    style="color: #111827 !important; background-color: #ffffff !important; min-width: 140px !important; padding: 0.75rem 2.5rem 0.75rem 1rem !important; border-radius: 0.5rem !important; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 4 5\"><path fill=\"%23666\" d=\"M2 0L0 2h4zm0 5L0 3h4z\"/></svg>') !important; background-repeat: no-repeat !important; background-position: right 12px center !important; background-size: 12px !important; appearance: none !important;">
                                <option value="all" {% if current_type == 'all' %}selected{% endif %}>All Properties</option>
                                <option value="buy" {% if current_type == 'buy' %}selected{% endif %}>For Sale</option>
                                <option value="lease" {% if current_type == 'lease' %}selected{% endif %}>For Lease</option>
                            </select>
                            <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold transition duration-300 whitespace-nowrap"
                                    style="background-color: #eab308 !important; color: #ffffff !important; padding: 0.75rem 1.5rem !important; border-radius: 0.5rem !important; font-weight: 600 !important; white-space: nowrap !important;">
                                Search
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Properties Grid -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        {% if properties %}
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">
                    {% if current_type == 'buy' %}
                        Properties for Sale
                    {% elif current_type == 'lease' %}
                        Properties for Lease
                    {% else %}
                        All Properties
                    {% endif %}
                </h2>
                <p class="text-gray-600">{{ properties|length }} property{{ properties|length|pluralize }} found</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for property in properties %}
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300 cursor-pointer {% if property.featured %}ring-2 ring-yellow-400{% endif %}" 
                     onclick="openPropertyModal({{ property.id }}, '{{ property.title|escapejs }}', '{{ property.location|escapejs }}', '{{ property.address|escapejs }}', '{{ property.price }}', '{{ property.property_type }}', '{{ property.bedrooms|default:"" }}', '{{ property.bathrooms|default:"" }}', '{{ property.parking_spaces|default:"" }}', '{{ property.area_sqft|default:"" }}', '{{ property.description|escapejs }}', '{{ property.get_main_image_url|escapejs }}', '{{ property.contact_email|escapejs }}', '{{ property.contact_phone|escapejs }}', {{ property.get_additional_images_list|safe }})">
                    {% if property.featured %}
                    <div class="bg-yellow-400 text-yellow-900 px-3 py-1 text-sm font-semibold text-center">
                        ⭐ FEATURED
                    </div>
                    {% endif %}
                    
                    <div class="relative">
                        <img src="{{ property.get_main_image_url }}" alt="{{ property.title }}" 
                             class="w-full h-64 object-cover">
                        <div class="absolute top-4 left-4">
                            <span class="bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-xs font-semibold">
                                {% if property.property_type == 'buy' %}💰 BUY{% else %}📋 LEASE{% endif %}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">{{ property.title }}</h3>
                        <p class="text-gray-600 mb-2">
                            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                            {{ property.location }}
                        </p>
                        <p class="text-gray-500 text-sm mb-4">{{ property.address }}</p>
                        
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-2xl font-bold text-green-600">
                                ${{ property.price|floatformat:0 }}
                                {% if property.property_type == 'lease' %}/month{% endif %}
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4 mb-4 text-sm text-gray-600">
                            {% if property.bedrooms %}
                            <span><i class="fas fa-bed text-blue-500 mr-1"></i>{{ property.bedrooms }} bed{{ property.bedrooms|pluralize }}</span>
                            {% endif %}
                            {% if property.bathrooms %}
                            <span><i class="fas fa-bath text-blue-500 mr-1"></i>{{ property.bathrooms }} bath{{ property.bathrooms|pluralize }}</span>
                            {% endif %}
                            {% if property.area_sqft %}
                            <span><i class="fas fa-ruler-combined text-blue-500 mr-1"></i>{{ property.area_sqft }} sqft</span>
                            {% endif %}
                        </div>
                        
                        <p class="text-gray-700 mb-4 line-clamp-2 text-sm">{{ property.description|truncatewords:15 }}</p>
                        
                        <div class="flex gap-2">
                            <button class="flex-1 bg-purple-600 hover:bg-purple-700 text-white text-center py-2 px-4 rounded-lg transition duration-300">
                                <i class="fas fa-eye mr-2"></i>View Details
                            </button>
                            <a href="mailto:{{ property.contact_email }}?subject=Inquiry about {{ property.title }}" 
                               class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-4 rounded-lg transition duration-300">
                                <i class="fas fa-envelope mr-2"></i>Email
                            </a>
                            <a href="tel:{{ property.contact_phone }}" 
                               class="flex-1 bg-green-600 hover:bg-green-700 text-white text-center py-2 px-4 rounded-lg transition duration-300">
                                <i class="fas fa-phone mr-2"></i>Call
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-16">
                <div class="text-gray-400 text-6xl mb-4">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-2">No Properties Found</h3>
                <p class="text-gray-600 mb-6">
                    {% if search_query %}
                        No properties match your search criteria. Try adjusting your filters.
                    {% else %}
                        No properties are currently available. Check back soon!
                    {% endif %}
                </p>
                {% if search_query %}
                <a href="{% url 'buy_lease' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-300">
                    View All Properties
                </a>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- Call to Action -->
    <div class="bg-blue-900 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl font-bold mb-4">Can't Find What You're Looking For?</h2>
            <p class="text-xl mb-8">Let us help you find the perfect property. Contact our team today!</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{% url 'selling' %}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-3 rounded-lg font-semibold transition duration-300">
                    List Your Property
                </a>
                <a href="{% url 'home' %}" class="bg-transparent border-2 border-white hover:bg-white hover:text-blue-900 text-white px-8 py-3 rounded-lg font-semibold transition duration-300">
                    Get Property Valuation
                </a>
            </div>
        </div>
    </div>
    </div>

<style>
.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

{% include 'Henry/footer.html' %}

<script>
// Theme Toggle Functionality
document.addEventListener("DOMContentLoaded", function() {
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const body = document.body;
    
    // Check for saved theme preference or default to light theme
    const currentTheme = localStorage.getItem('theme') || 'light';
    
    // Apply the saved theme
    if (currentTheme === 'dark') {
        body.classList.add('dark-theme');
        themeIcon.className = 'fas fa-sun text-white text-lg';
    } else {
        body.classList.remove('dark-theme');
        themeIcon.className = 'fas fa-moon text-white text-lg';
    }
    
    // Theme toggle event listener
    themeToggle.addEventListener('click', function() {
        if (body.classList.contains('dark-theme')) {
            // Switch to light theme
            body.classList.remove('dark-theme');
            themeIcon.className = 'fas fa-moon text-white text-lg';
            localStorage.setItem('theme', 'light');
        } else {
            // Switch to dark theme
            body.classList.add('dark-theme');
            themeIcon.className = 'fas fa-sun text-white text-lg';
            localStorage.setItem('theme', 'dark');
        }
    });
});

// Property Modal Functions
function openPropertyModal(id, title, location, address, price, propertyType, bedrooms, bathrooms, parkingSpaces, areaSqft, description, imageUrl, contactEmail, contactPhone, additionalImages) {
    const modal = document.getElementById('propertyModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalLocation = document.getElementById('modalLocation');
    const modalAddress = document.getElementById('modalAddress');
    const modalPrice = document.getElementById('modalPrice');
    const modalPropertyType = document.getElementById('modalPropertyType');
    const modalBedrooms = document.getElementById('modalBedrooms');
    const modalBathrooms = document.getElementById('modalBathrooms');
    const modalParking = document.getElementById('modalParking');
    const modalArea = document.getElementById('modalArea');
    const modalDescription = document.getElementById('modalDescription');
    const modalImage = document.getElementById('modalImage');
    const modalContactEmail = document.getElementById('modalContactEmail');
    const modalContactPhone = document.getElementById('modalContactPhone');
    const modalAdditionalImages = document.getElementById('modalAdditionalImages');
    
    // Populate modal content
    modalTitle.textContent = title;
    modalLocation.textContent = location;
    modalAddress.textContent = address;
    modalPrice.textContent = '$' + parseFloat(price).toLocaleString() + (propertyType === 'lease' ? '/month' : '');
    modalPropertyType.textContent = propertyType === 'buy' ? '💰 FOR SALE' : '📋 FOR LEASE';
    modalDescription.textContent = description;
    modalImage.src = imageUrl;
    modalImage.alt = title;
    
    // Contact info
    modalContactEmail.href = 'mailto:' + contactEmail + '?subject=Inquiry about ' + title;
    modalContactPhone.href = 'tel:' + contactPhone;
    
    // Property details
    modalBedrooms.textContent = bedrooms ? bedrooms + ' bed' + (bedrooms > 1 ? 's' : '') : 'N/A';
    modalBathrooms.textContent = bathrooms ? bathrooms + ' bath' + (bathrooms > 1 ? 's' : '') : 'N/A';
    modalParking.textContent = parkingSpaces ? parkingSpaces + ' parking space' + (parkingSpaces > 1 ? 's' : '') : 'N/A';
    modalArea.textContent = areaSqft ? areaSqft + ' sqft' : 'N/A';
    
    // Additional images
    modalAdditionalImages.innerHTML = '';
    if (additionalImages && additionalImages.length > 0) {
        additionalImages.forEach(function(imageUrl) {
            if (imageUrl.trim()) {
                const img = document.createElement('img');
                img.src = imageUrl.trim();
                img.alt = title;
                img.className = 'w-full h-32 object-cover rounded-lg';
                img.onclick = function() {
                    modalImage.src = imageUrl.trim();
                };
                modalAdditionalImages.appendChild(img);
            }
        });
    }
    
    // Show modal
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closePropertyModal() {
    const modal = document.getElementById('propertyModal');
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
}

// Close modal when clicking outside or pressing Escape
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('propertyModal');
    
    // Close modal when clicking outside
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            closePropertyModal();
        }
    });
    
    // Close modal when pressing Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
            closePropertyModal();
        }
    });
});
</script>

<!-- Property Details Modal -->
<div id="propertyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <!-- Modal Header -->
        <div class="flex justify-between items-center p-6 border-b">
            <h2 id="modalTitle" class="text-2xl font-bold text-gray-900"></h2>
            <button onclick="closePropertyModal()" class="text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 text-2xl transition duration-300">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Modal Content -->
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column - Image and Basic Info -->
                <div>
                    <div class="mb-4">
                        <img id="modalImage" src="" alt="" class="w-full h-64 object-cover rounded-lg">
                    </div>
                    
                    <!-- Additional Images -->
                    <div id="modalAdditionalImages" class="grid grid-cols-3 gap-2 mb-4"></div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <i class="fas fa-map-marker-alt text-blue-500 mr-3"></i>
                            <span id="modalLocation" class="text-gray-700"></span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-home text-blue-500 mr-3"></i>
                            <span id="modalAddress" class="text-gray-700"></span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-tag text-blue-500 mr-3"></i>
                            <span id="modalPropertyType" class="text-gray-700"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Details and Contact -->
                <div>
                    <div class="mb-6">
                        <div class="text-3xl font-bold text-green-600 mb-4">
                            <span id="modalPrice"></span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-bed text-blue-500 text-xl mb-2"></i>
                                <div class="text-sm text-gray-600">Bedrooms</div>
                                <div id="modalBedrooms" class="font-semibold"></div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-bath text-blue-500 text-xl mb-2"></i>
                                <div class="text-sm text-gray-600">Bathrooms</div>
                                <div id="modalBathrooms" class="font-semibold"></div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-car text-blue-500 text-xl mb-2"></i>
                                <div class="text-sm text-gray-600">Parking</div>
                                <div id="modalParking" class="font-semibold"></div>
                            </div>
                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-ruler-combined text-blue-500 text-xl mb-2"></i>
                                <div class="text-sm text-gray-600">Area</div>
                                <div id="modalArea" class="font-semibold"></div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">Description</h3>
                            <p id="modalDescription" class="text-gray-700 leading-relaxed"></p>
                        </div>
                        
                        <div class="space-y-3">
                            <h3 class="text-lg font-semibold text-gray-900">Contact Information</h3>
                            <a id="modalContactEmail" href="#" class="flex items-center p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition duration-300">
                                <i class="fas fa-envelope text-blue-500 mr-3"></i>
                                <span class="text-blue-700">Send Email</span>
                            </a>
                            <a id="modalContactPhone" href="#" class="flex items-center p-3 bg-green-50 hover:bg-green-100 rounded-lg transition duration-300">
                                <i class="fas fa-phone text-green-500 mr-3"></i>
                                <span class="text-green-700">Call Now</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal Footer -->
        <div class="flex justify-end p-6 border-t bg-gray-50">
            <button onclick="closePropertyModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-300">
                <i class="fas fa-times mr-2"></i>Close
            </button>
        </div>
    </div>
</div>

</body>
</html>
